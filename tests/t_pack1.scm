;; -*- Mode: Irken -*-

(include "lib/basis.scm")
(include "lib/pack.scm")

(let ((p (pbuf/make 10)))
  (p@u8 17)
  (p@u8 23)
  (p@i8 -15)
  (p@i16 -1234)
  (p@u16 65530)
  (p@i32 -324923423)
  (p@u32 314159265)
  (p@string "testing!")
  (let ((v (p@val))
        (u (ubuf/make v)))
    (printn v)
    (printn (u@u8))
    (printn (u@u8))
    (printn (u@i8))
    (printn (u@i16))
    (printn (u@u16))
    (printn (u@i32))
    (printn (u@u32))
    (printn (u@string 8))
    )
  )

(printf "val: 0x" (hex (packbits (16 #xabcd) (16 #x1234))) "\n")
(printf "val: 0x" (hex (packbits (3 1) (3 1) (3 1) (3 7))) "\n")
(printf "val: 0x" (hex (packbits (8 #xef) (8 #xbe) (8 #xad) (8 #xde))) "\n")
(printf "val: 0x" (hex (packbits (18 73458) (12 2719))) "\n")
(let ((v0 (packbits (3 0) (3 1) (3 2) (3 7)))
      (r {a=0 b=0 c=0 d=0}))
  (unpackbits v0 (3 r.a) (3 r.b) (3 r.c) (3 r.d))
  r)
